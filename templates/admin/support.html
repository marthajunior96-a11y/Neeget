{% extends "admin/base_admin.html" %}

{% block title %}Support Tickets{% endblock %}

{% block breadcrumb %}
<i class="fas fa-headset"></i>
<span>Support Tickets</span>
{% endblock %}

{% block content %}
<h1 class="admin-page-title"><i class="fas fa-life-ring"></i> Support Tickets</h1>

<div class="admin-table">
    <table class="table">
        <thead>
            <tr><th>ID</th><th>User</th><th>Issue</th><th>Status</th><th>Created</th><th>Actions</th></tr>
        </thead>
        <tbody>
            {% for ticket in tickets %}
            <tr>
                <td>{{ ticket.id }}</td>
                <td>{{ ticket.user.name if ticket.user else 'Unknown' }}</td>
                <td>{{ ticket.issue_description[:50] }}...</td>
                <td>
                    {% if ticket.status == 'open' %}<span class="badge badge-admin-danger">{{ ticket.status }}</span>
                    {% elif ticket.status == 'in_progress' %}<span class="badge badge-admin-warning">{{ ticket.status }}</span>
                    {% else %}<span class="badge badge-admin-success">{{ ticket.status }}</span>{% endif %}
                </td>
                <td>{{ ticket.created_at[:10] if ticket.created_at else 'N/A' }}</td>
                <td>
                    <form method="POST" action="{{ url_for('admin.update_ticket_status', ticket_id=ticket.id) }}" style="display:inline;">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                        <select name="status" class="form-control form-control-sm" style="display:inline; width:auto;" onchange="this.form.submit()">
                            <option value="open" {{ 'selected' if ticket.status == 'open' else '' }}>Open</option>
                            <option value="in_progress" {{ 'selected' if ticket.status == 'in_progress' else '' }}>In Progress</option>
                            <option value="resolved" {{ 'selected' if ticket.status == 'resolved' else '' }}>Resolved</option>
                            <option value="closed" {{ 'selected' if ticket.status == 'closed' else '' }}>Closed</option>
                        </select>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
