{% extends "admin/base_admin.html" %}
{% block admin_content %}
<h1 class="admin-page-title"><i class="fas fa-shield-alt"></i> Fraud Monitoring</h1>

<div class="admin-card mb-4">
    <h5><i class="fas fa-exclamation-triangle"></i> Providers with Low Ratings</h5>
    <div class="admin-table">
        <table class="table">
            <thead>
                <tr><th>Name</th><th>Avg Rating</th><th>Reviews</th><th>Actions</th></tr>
            </thead>
            <tbody>
                {% for provider in flagged_providers %}
                <tr>
                    <td>{{ provider.name }}</td>
                    <td><span class="badge badge-admin-danger">{{ provider.avg_rating }} ‚≠ê</span></td>
                    <td>{{ provider.review_count }}</td>
                    <td><a href="{{ url_for('admin.user_detail', user_id=provider.id) }}" class="btn btn-sm btn-info"><i class="fas fa-search"></i> Investigate</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="admin-card mb-4">
    <h5><i class="fas fa-ban"></i> Users with Multiple Cancellations</h5>
    <div class="admin-table">
        <table class="table">
            <thead>
                <tr><th>Name</th><th>Email</th><th>Cancellations</th><th>Actions</th></tr>
            </thead>
            <tbody>
                {% for user in flagged_users %}
                <tr>
                    <td>{{ user.name }}</td>
                    <td>{{ user.email }}</td>
                    <td><span class="badge badge-admin-warning">{{ user.cancellation_count }}</span></td>
                    <td><a href="{{ url_for('admin.flag_user', user_id=user.id) }}" class="btn btn-sm btn-warning"><i class="fas fa-flag"></i> Flag</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="admin-card mb-4">
    <h5><i class="fas fa-copy"></i> Duplicate Accounts Detected</h5>
    {% for dup in duplicate_accounts %}
    <div class="alert alert-warning">
        <strong>{{ dup.type }}: {{ dup.identifier }}</strong><br>
        Found in {{ dup.users|length }} accounts:
        {% for user in dup.users %}
            <a href="{{ url_for('admin.user_detail', user_id=user.id) }}">{{ user.name }}</a>{% if not loop.last %}, {% endif %}
        {% endfor %}
    </div>
    {% endfor %}
</div>

<div class="admin-card">
    <h5><i class="fas fa-credit-card"></i> Suspicious Payment Patterns</h5>
    <div class="admin-table">
        <table class="table">
            <thead>
                <tr><th>Name</th><th>Email</th><th>Failed Payments</th><th>Actions</th></tr>
            </thead>
            <tbody>
                {% for user in suspicious_payments %}
                <tr>
                    <td>{{ user.name }}</td>
                    <td>{{ user.email }}</td>
                    <td><span class="badge badge-admin-danger">{{ user.failed_payment_count }}</span></td>
                    <td><a href="{{ url_for('admin.user_detail', user_id=user.id) }}" class="btn btn-sm btn-info"><i class="fas fa-search"></i> Investigate</a></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}