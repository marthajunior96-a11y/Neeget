{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1>Admin Dashboard</h1>
    
    <!-- Key Metrics Cards -->
    <div class="row mt-4">
        <div class="col-md-3">
            <div class="card bg-primary text-white">
                <div class="card-body">
                    <h3>{{ metrics.total_users + metrics.total_providers }}</h3>
                    <p>Total Users</p>
                    <small>{{ metrics.total_users }} users | {{ metrics.total_providers }} providers</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-success text-white">
                <div class="card-body">
                    <h3>{{ metrics.total_bookings }}</h3>
                    <p>Total Bookings</p>
                    <small>{{ metrics.completed_bookings }} completed</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-info text-white">
                <div class="card-body">
                    <h3>${{ metrics.total_revenue }}</h3>
                    <p>Total Revenue</p>
                    <small>${{ metrics.platform_fees }} in fees</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card bg-warning text-white">
                <div class="card-body">
                    <h3>{{ metrics.open_tickets }}</h3>
                    <p>Open Tickets</p>
                    <small>Support requests</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Status Cards -->
    <div class="row mt-4">
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <h5>{{ metrics.pending_services }}</h5>
                    <p>Pending Services</p>
                    <a href="{{ url_for('admin.manage_services', status='pending_approval') }}" class="btn btn-sm btn-outline-primary">Review</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <h5>{{ metrics.flagged_accounts }}</h5>
                    <p>Flagged Accounts</p>
                    <a href="{{ url_for('admin.fraud_monitoring') }}" class="btn btn-sm btn-outline-danger">Investigate</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <h5>{{ metrics.pending_bookings }}</h5>
                    <p>Pending Bookings</p>
                    <a href="{{ url_for('admin.manage_bookings', status='pending') }}" class="btn btn-sm btn-outline-info">View</a>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card">
                <div class="card-body">
                    <h5>{{ metrics.verified_users }}/{{ metrics.total_users }}</h5>
                    <p>Verified Users</p>
                    <a href="{{ url_for('admin.manage_users', verified='no') }}" class="btn btn-sm btn-outline-secondary">Review</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Links -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header"><h5>Quick Actions</h5></div>
                <div class="card-body">
                    <a href="{{ url_for('admin.manage_users') }}" class="btn btn-primary mr-2">Manage Users</a>
                    <a href="{{ url_for('admin.manage_services') }}" class="btn btn-success mr-2">Manage Services</a>
                    <a href="{{ url_for('admin.manage_categories') }}" class="btn btn-info mr-2">Manage Categories</a>
                    <a href="{{ url_for('admin.manage_bookings') }}" class="btn btn-warning mr-2">Manage Bookings</a>
                    <a href="{{ url_for('admin.manage_reviews') }}" class="btn btn-secondary mr-2">Manage Reviews</a>
                    <a href="{{ url_for('admin.settings') }}" class="btn btn-dark mr-2">Platform Settings</a>
                    <a href="{{ url_for('admin.analytics') }}" class="btn btn-primary mr-2">Analytics</a>
                    <a href="{{ url_for('admin.fraud_monitoring') }}" class="btn btn-danger mr-2">Fraud Monitoring</a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recent Activity -->
    <div class="row mt-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header"><h5>Recent Users</h5></div>
                <div class="card-body">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Joined</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for user in metrics.recent_users %}
                            <tr>
                                <td>{{ user.name }}</td>
                                <td>{{ user.role }}</td>
                                <td>{{ user.created_at[:10] if user.created_at else 'N/A' }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-header"><h5>Service Popularity</h5></div>
                <div class="card-body">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Bookings</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for category, count in metrics.service_popularity.items() %}
                            <tr>
                                <td>{{ category }}</td>
                                <td>{{ count }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
